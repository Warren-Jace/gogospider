# 🔒 敏感信息统一管理系统 - 使用指南

## 📋 概述

**GogoSpider v4.2** 引入了全新的**敏感信息统一管理系统**，提供集中化的敏感信息收集、分类、去重和多格式导出功能。

### ✨ 核心特性

- **🎯 统一管理**：所有敏感信息通过统一接口管理
- **🗂️ 智能去重**：自动去除重复的敏感信息（相同类型+值+URL）
- **📊 多种格式**：一次导出5种格式（TXT、JSON、CSV、HTML、Summary）
- **📈 可视化报告**：美观的HTML报告，便于查看和分享
- **🔍 详细分类**：按严重程度、类型、URL自动分类
- **💾 Excel友好**：CSV格式支持中文，可直接用Excel打开

---

## 📦 导出文件说明

### 新的统一导出方式会生成以下文件：

| 文件名 | 格式 | 用途 | 特点 |
|--------|------|------|------|
| `sensitive_{domain}_{timestamp}.txt` | 文本 | 详细文本报告 | 按严重程度分组，含完整信息 |
| `sensitive_{domain}_{timestamp}.json` | JSON | 结构化数据 | 便于程序化处理和集成 |
| `sensitive_{domain}_{timestamp}.csv` | CSV | Excel表格 | 支持中文，可用Excel分析 |
| `sensitive_{domain}_{timestamp}.html` | HTML | 可视化报告 | 美观的网页报告，可直接分享 |
| `sensitive_{domain}_{timestamp}_summary.txt` | 文本 | 快速摘要 | 快速了解总体情况 |

---

## 🚀 使用方法

### 方法一：使用新的统一导出API（推荐）

```go
// 在Spider爬取完成后，使用统一导出
spider := core.NewSpider(cfg)
err := spider.Start(targetURL)

// 统一导出所有格式
outputDir := "."  // 输出目录
baseFilename := "sensitive_example_com_20251028"
err = spider.ExportSensitiveInfoUnified(outputDir, baseFilename)
if err != nil {
    log.Printf("导出敏感信息失败: %v", err)
}
```

### 方法二：使用旧的单独导出（保持兼容）

```go
// 仍然可以使用，但已标记为废弃
spider.SaveSensitiveInfoToFile("sensitive.txt")
spider.SaveSensitiveInfoToJSON("sensitive.json")
```

---

## 📝 在main.go中集成

### 修改建议（已为您准备好的示例）：

```go
// 在 cmd/spider/main.go 中的保存结果部分

// 🆕 敏感信息统一导出（如果启用）
if enableSensitiveDetection {
    // 🔧 新方式：统一导出所有格式
    if err := spider.ExportSensitiveInfoUnified(".", baseFilename); err != nil {
        log.Printf("统一导出敏感信息失败: %v", err)
    }
    
    // 🔧 旧方式（保持兼容，但已废弃）
    // sensitiveFile := baseFilename + "_sensitive.txt"
    // if err := spider.SaveSensitiveInfoToFile(sensitiveFile); err != nil {
    //     log.Printf("保存敏感信息失败: %v", err)
    // }
}
```

---

## 📊 报告内容示例

### 1. 文本报告（.txt）

```
╔══════════════════════════════════════════════════════════════╗
║             敏感信息泄露检测报告 (文本格式)                    ║
╚══════════════════════════════════════════════════════════════╝

【扫描概况】
  目标域名: example.com
  扫描时间: 2025-10-28 15:30:00
  发现总数: 15（已去重）
  受影响URL数: 8

【严重程度分布】
  🔴 高危 (HIGH):   3
  🟡 中危 (MEDIUM): 7
  🟢 低危 (LOW):    5

【类型分布】
  - API密钥泄露                    : 2
  - 数据库连接字符串                : 1
  - 邮箱地址                       : 7
  - 内部IP地址                     : 5
  
================================================================

🔴 高危发现（共 3 项）
----------------------------------------------------------------

[1] API密钥泄露
    来源URL: https://example.com/api/config.js
    位置: Line 45
    值: AIza****************************xyz
```

### 2. HTML报告（.html）

- 美观的网页界面
- 支持浏览器直接打开
- 按颜色区分严重程度（红/黄/绿）
- 响应式设计，支持移动端查看
- 可直接分享给团队成员

### 3. CSV报告（.csv）

| 序号 | 严重程度 | 类型 | 来源URL | 位置 | 脱敏值 | 完整值 |
|------|----------|------|---------|------|--------|--------|
| 1 | HIGH | API密钥泄露 | https://... | Line 45 | AIza****xyz | (完整值) |
| 2 | MEDIUM | 邮箱地址 | https://... | Line 102 | admi****com | admin@example.com |

### 4. JSON报告（.json）

```json
{
  "report_version": "1.0",
  "report_type": "Sensitive Information Disclosure Report",
  "generated_at": "2025-10-28T15:30:00+08:00",
  "statistics": {
    "total_unique_findings": 15,
    "target_domain": "example.com",
    "by_severity": {
      "HIGH": 3,
      "MEDIUM": 7,
      "LOW": 5
    },
    "by_type": {
      "API密钥泄露": 2,
      "数据库连接字符串": 1,
      "邮箱地址": 7
    },
    "affected_urls_count": 8
  },
  "findings": [...]
}
```

### 5. 摘要报告（_summary.txt）

```
╔══════════════════════════════════════════════════════════════╗
║                  敏感信息检测摘要报告                          ║
╚══════════════════════════════════════════════════════════════╝

目标域名: example.com
扫描时间: 2025-10-28 15:30:00
发现总数: 15（已去重）

【严重程度分布】
  🔴 高危:  3
  🟡 中危:  7
  🟢 低危:  5

【风险评估】
  ⚠️  存在高危敏感信息泄露，建议立即修复！

【类型分布 TOP 10】
  1. 邮箱地址                         : 7
  2. 内部IP地址                       : 5
  3. API密钥泄露                      : 2
  4. 数据库连接字符串                  : 1

【受影响URL统计】
  受影响URL总数: 8
  受影响最多的URL:
    1. https://example.com/api/config.js (5 项)
    2. https://example.com/js/app.js (3 项)
    3. https://example.com/admin/index.html (2 项)
```

---

## 🎯 核心功能对比

### 旧方式 vs 新方式

| 特性 | 旧方式 | 新方式（v4.2） |
|------|--------|----------------|
| 导出格式 | TXT、JSON | TXT、JSON、CSV、HTML、Summary |
| 去重功能 | ❌ 无 | ✅ 智能去重 |
| 分类统计 | ⚠️ 基础 | ✅ 详细分类 |
| 可视化 | ❌ 无 | ✅ HTML报告 |
| Excel支持 | ❌ 无 | ✅ CSV格式 |
| 一键导出 | ❌ 需要多次调用 | ✅ 一次调用全部导出 |
| 受影响URL统计 | ❌ 无 | ✅ 详细统计 |
| 风险评估 | ❌ 无 | ✅ 自动评估 |

---

## 📂 文件结构

```
输出目录/
├── sensitive_example_com_20251028.txt          # 详细文本报告
├── sensitive_example_com_20251028.json         # 结构化JSON
├── sensitive_example_com_20251028.csv          # Excel表格
├── sensitive_example_com_20251028.html         # 可视化报告
└── sensitive_example_com_20251028_summary.txt  # 快速摘要
```

---

## 🔧 高级用法

### 自定义输出配置

```go
// 自定义管理器配置
manager := core.NewSensitiveInfoManager(core.SensitiveInfoManagerConfig{
    TargetDomain:  "example.com",
    OutputDir:     "./reports",  // 自定义输出目录
    BaseFilename:  "my_custom_name",  // 自定义文件名
    Detector:      spider.GetSensitiveDetector(),
})

// 收集并去重
manager.CollectFindings()

// 导出所有格式
err := manager.ExportAll()
```

### 只导出特定格式

```go
manager := core.NewSensitiveInfoManager(...)
manager.CollectFindings()

// 只导出HTML报告
err := manager.ExportHTML()

// 只导出CSV表格
err := manager.ExportCSV()

// 只导出JSON
err := manager.ExportJSON()
```

---

## 💡 最佳实践

### 1. 日常使用

```bash
# 使用默认配置，自动生成所有格式
./spider -url https://example.com -sensitive-detect -sensitive-rules sensitive_rules_standard.json
```

### 2. 批量扫描

```bash
# 批量扫描时，每个目标都会生成独立的敏感信息报告
./spider -batch-file targets.txt -config config.json
```

### 3. 查看报告

```bash
# 1. 快速查看摘要（推荐第一步）
cat sensitive_example_com_*_summary.txt

# 2. 查看详细文本报告
cat sensitive_example_com_*.txt

# 3. 在浏览器中打开HTML报告（最直观）
open sensitive_example_com_*.html  # macOS
start sensitive_example_com_*.html  # Windows

# 4. 在Excel中打开CSV
open sensitive_example_com_*.csv  # 使用Excel打开
```

### 4. 集成到CI/CD

```bash
# 在CI/CD中使用JSON格式进行自动化分析
./spider -url $TARGET_URL -sensitive-detect -sensitive-rules rules.json

# 解析JSON并检查高危发现
HIGH_COUNT=$(jq '.statistics.by_severity.HIGH' sensitive_*.json)
if [ "$HIGH_COUNT" -gt 0 ]; then
    echo "❌ 发现 $HIGH_COUNT 项高危敏感信息，构建失败！"
    exit 1
fi
```

---

## 🛠️ 技术细节

### 去重机制

敏感信息去重基于以下条件：
```
唯一键 = 类型 + 完整值 + 来源URL
```

例如：
- ✅ 相同邮箱在同一URL出现多次 → 去重为1项
- ✅ 相同邮箱在不同URL出现 → 保留2项（不同来源）
- ✅ 不同邮箱在同一URL → 保留2项（不同值）

### 输出性能

- **小型扫描**（<100个敏感信息）：导出时间 < 1秒
- **中型扫描**（100-1000个）：导出时间 1-3秒
- **大型扫描**（>1000个）：导出时间 3-10秒

### 文件编码

- **TXT文件**：UTF-8编码
- **JSON文件**：UTF-8编码
- **CSV文件**：UTF-8 with BOM（确保Excel正确显示中文）
- **HTML文件**：UTF-8编码

---

## 📌 常见问题

### Q1: 如何只生成特定格式的报告？

A: 使用低级API：
```go
manager := core.NewSensitiveInfoManager(...)
manager.CollectFindings()
manager.ExportHTML()  // 只导出HTML
```

### Q2: 报告文件命名规则是什么？

A: 默认规则：`sensitive_{domain}_{timestamp}.{ext}`
- `domain`: 从目标URL提取的域名（去除协议和端口）
- `timestamp`: 扫描时间（格式：20251028_153000）
- `ext`: 文件扩展名（txt/json/csv/html）

### Q3: CSV文件在Excel中乱码怎么办？

A: 已自动添加UTF-8 BOM标记，现代Excel应该能正确识别。如果仍然乱码：
1. 使用Excel的"数据" → "从文本/CSV"导入功能
2. 选择UTF-8编码
3. 或使用WPS Office（对UTF-8支持更好）

### Q4: 旧的SaveSensitiveInfoToFile还能用吗？

A: 可以继续使用，但已标记为废弃。建议迁移到新的`ExportSensitiveInfoUnified()`方法。

### Q5: 如何自定义HTML报告样式？

A: 编辑 `core/sensitive_info_manager.go` 中的HTML模板部分即可。

---

## 🎉 更新日志

### v4.2（2025-10-28）
- ✅ 新增敏感信息统一管理器
- ✅ 支持5种格式导出（TXT、JSON、CSV、HTML、Summary）
- ✅ 智能去重功能
- ✅ 可视化HTML报告
- ✅ Excel友好的CSV格式
- ✅ 详细的统计和分类
- ✅ 风险评估功能
- ✅ 旧API保持兼容

---

## 📞 技术支持

如有问题或建议，请：
1. 查看项目文档：README.md
2. 提交Issue：GitHub Issues
3. 联系作者：[项目主页]

---

## 📄 相关文档

- [README.md](README.md) - 项目总体文档
- [URL过滤管理器使用指南](【立即使用】URL过滤管理器.md) - URL过滤功能
- [快速开始v4.2](🚀快速开始_v4.2新特性.md) - v4.2新特性总览

---

**GogoSpider v4.2** - 让敏感信息检测更专业、更高效！

