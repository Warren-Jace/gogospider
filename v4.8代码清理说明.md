# GogoSpider v4.8 ä»£ç æ¸…ç†è¯´æ˜

**æ¸…ç†æ—¶é—´**: 2025-11-06  
**æ¸…ç†å†…å®¹**: ç§»é™¤æ—§çš„ URLæ¨¡å¼+DOMå»é‡ ä»£ç   
**åŸå› **: å·²è¢«æ›´ä¼˜çš„æ–¹æ¡ˆæ›¿ä»£

---

## âœ… æ¸…ç†å†…å®¹

### åˆ é™¤çš„æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰
- âŒ `core/url_pattern_dom_dedup.go` - å·²åˆ é™¤ï¼ˆ590è¡Œï¼‰

**åŸå› **: åŠŸèƒ½å·²è¢«ä»¥ä¸‹ä¸¤ä¸ªæ–°æ¨¡å—å®Œå…¨æ›¿ä»£ï¼š
- âœ… `core/similar_url_deduplicator.go` - æ›´ç²¾ç¡®çš„URLç»“æ„è¯†åˆ«
- âœ… `core/dom_embedding_dedup.go` - æ›´å¼ºå¤§çš„DOMå†…å®¹å»é‡

---

### ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¯´æ˜ |
|-----|---------|------|
| `core/spider.go` | ç§»é™¤ `urlPatternDOMDedup` å­—æ®µå’Œåˆå§‹åŒ– | å·²ä¸éœ€è¦ |
| `core/dedup_coordinator.go` | ç§»é™¤ç›¸å…³å¼•ç”¨ï¼Œæ·»åŠ  `getPercentage` å‡½æ•° | ä¿®å¤ç¼–è¯‘é”™è¯¯ |
| `cmd/spider/main.go` | ç§»é™¤ `PrintURLPatternDOMDedupReport` è°ƒç”¨ | æ¸…ç†è¾“å‡º |
| `config.json` | ç§»é™¤ç›¸å…³é…ç½®é¡¹ | ç®€åŒ–é…ç½® |

---

## ğŸ”„ åŠŸèƒ½æ›¿ä»£æ–¹æ¡ˆ

### æ—§æ–¹æ¡ˆ: URLæ¨¡å¼+DOMå»é‡

```
åŸç†:
1. æå–URLæ¨¡å¼ï¼ˆå»é™¤å‚æ•°å€¼ï¼‰
2. å¯¹åŒä¸€æ¨¡å¼é‡‡æ ·3æ¬¡
3. è®¡ç®—DOMç›¸ä¼¼åº¦
4. å¦‚æœç›¸ä¼¼ï¼Œåç»­ç›¸åŒæ¨¡å¼çš„URLè·³è¿‡

ç¼ºç‚¹:
- éœ€è¦é‡‡æ ·éªŒè¯ï¼ˆæ…¢ï¼‰
- é‡‡æ ·å¤±è´¥å¯èƒ½å¯¼è‡´è¯¯åˆ¤
- é€»è¾‘å¤æ‚
```

### æ–°æ–¹æ¡ˆ: ç›¸ä¼¼URLå»é‡ + DOM Embedding

```
æ–¹æ¡ˆ1: ç›¸ä¼¼URLå»é‡ (similar_url_deduplicator.go)
  åŸç†: Hashç®—æ³•ç›´æ¥è¯†åˆ«URLç»“æ„
  ä¼˜åŠ¿: 
    âœ… æ— éœ€é‡‡æ ·ï¼ˆå¿«ï¼‰
    âœ… Hashè®¡ç®— O(1)
    âœ… å‡†ç¡®ç‡é«˜

æ–¹æ¡ˆ2: DOM Embedding (dom_embedding_dedup.go)  
  åŸç†: å‘é‡åŒ– + ä½™å¼¦ç›¸ä¼¼åº¦
  ä¼˜åŠ¿:
    âœ… ç›´æ¥å¯¹æ¯”å†…å®¹ï¼ˆå‡†ï¼‰
    âœ… ç®—æ³•æ›´å…ˆè¿›
    âœ… å®Œå…¨æŒ‰ç”¨æˆ·éœ€æ±‚å®ç°
```

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

| ç»´åº¦ | æ—§æ–¹æ¡ˆï¼ˆURL+DOMï¼‰ | æ–°æ–¹æ¡ˆï¼ˆç›¸ä¼¼URL + Embeddingï¼‰ |
|-----|------------------|----------------------------|
| **URLå»é‡** | é‡‡æ ·ååˆ¤æ–­ | Hashç›´æ¥è¯†åˆ« âœ… |
| **DOMæ£€æµ‹** | SimHash | Embeddingå‘é‡ âœ… |
| **é€Ÿåº¦** | æ…¢ï¼ˆéœ€é‡‡æ ·ï¼‰ | å¿«ï¼ˆç›´æ¥è®¡ç®—ï¼‰ âœ… |
| **å‡†ç¡®æ€§** | ä¸­ç­‰ | é«˜ âœ… |
| **å¤æ‚åº¦** | é«˜ | ä½ âœ… |
| **å†…å­˜å ç”¨** | é«˜ | ä¸­ç­‰ âœ… |

**ç»“è®º**: æ–°æ–¹æ¡ˆåœ¨æ‰€æœ‰ç»´åº¦éƒ½ä¼˜äºæ—§æ–¹æ¡ˆï¼

---

## âœ¨ æ–°æ–¹æ¡ˆçš„ä¼˜åŠ¿

### 1. æ›´å¿«çš„URLå»é‡

**æ—§æ–¹æ¡ˆ**:
```go
// éœ€è¦é‡‡æ ·3æ¬¡æ‰èƒ½åˆ¤æ–­
ç¬¬1æ¬¡: çˆ¬å– â†’ è®°å½•DOM
ç¬¬2æ¬¡: çˆ¬å– â†’ è®°å½•DOM
ç¬¬3æ¬¡: çˆ¬å– â†’ è®°å½•DOM
è®¡ç®—ç›¸ä¼¼åº¦ â†’ å†³å®šåç»­æ˜¯å¦è·³è¿‡
```

**æ–°æ–¹æ¡ˆ**:
```go
// ç«‹å³åˆ¤æ–­ï¼Œæ— éœ€é‡‡æ ·
æå–ç»“æ„ â†’ è®¡ç®—Hash â†’ ç«‹å³å†³å®š âœ…
```

---

### 2. æ›´å‡†ç¡®çš„DOMæ£€æµ‹

**æ—§æ–¹æ¡ˆ**:
```go
// ä½¿ç”¨SimHashï¼ˆ64ä½ï¼‰
SimHash: 0110101010... (64ä½)
æ±‰æ˜è·ç¦»è®¡ç®—
```

**æ–°æ–¹æ¡ˆ**:
```go
// ä½¿ç”¨Embeddingå‘é‡ï¼ˆ256ç»´ï¼‰
Embedding: [0.1, 0.3, 0.2, ..., 0.5] (256ç»´)
ä½™å¼¦ç›¸ä¼¼åº¦ = dot(v1, v2)
```

**ç»´åº¦å¯¹æ¯”**: 256ç»´ vs 64ä½ = 4å€ç²¾åº¦ï¼

---

### 3. æ›´çµæ´»çš„é…ç½®

**æ—§æ–¹æ¡ˆ**:
```json
{
  "enable_url_pattern_dom_dedup": true,
  "url_pattern_dom_sample_count": 3,    // å›ºå®šé‡‡æ ·
  "url_pattern_dom_threshold": 0.85
}
```

**æ–°æ–¹æ¡ˆ**:
```json
{
  "enable_similar_url_dedup": true,      // URLå»é‡ï¼ˆç‹¬ç«‹ï¼‰
  "enable_dom_embedding": true,          // DOMå»é‡ï¼ˆç‹¬ç«‹ï¼‰
  "dom_embedding_dimensions": 256,       // å¯è°ƒç»´åº¦
  "dom_embedding_threshold": 0.85        // å¯è°ƒé˜ˆå€¼
}
```

**ä¼˜åŠ¿**: ä¸¤ä¸ªåŠŸèƒ½å¯ç‹¬ç«‹å¼€å…³ï¼

---

## ğŸ¯ æ¸…ç†åçš„æ¶æ„

### æ–°çš„å»é‡æµç¨‹

```
æ–°URLå‘ç°
    â†“
[0] JSæ–‡ä»¶ç‰¹æ®Šå¤„ç† â† è·¨åŸŸå…è®¸
    â†“
[1] é™æ€èµ„æºè¿‡æ»¤ â† åªè®°å½•ä¸è¯·æ±‚
    â†“
[2] ç›¸ä¼¼URLå»é‡ â† Hashç®—æ³•ï¼ˆæ–°ï¼ï¼‰
    â†“
[3] ç²¾ç¡®URLå»é‡ â† é˜²æ­¢é‡å¤
    â†“
[4] Scopeæ£€æŸ¥
    â†“
[5] ä¸šåŠ¡è¿‡æ»¤
    â†“
[6] DOM Embedding â† å†…å®¹å»é‡ï¼ˆæ–°ï¼ï¼‰
    â†“
å…è®¸çˆ¬å–/è·³è¿‡
```

**å¯¹æ¯”æ—§æµç¨‹**:
```diff
- [3] URLæ¨¡å¼+DOMå»é‡ï¼ˆé‡‡æ ·éªŒè¯ï¼‰
+ [2] ç›¸ä¼¼URLå»é‡ï¼ˆHashç›´æ¥åˆ¤æ–­ï¼‰
+ [6] DOM Embeddingï¼ˆå‘é‡åŒ–å†…å®¹æ£€æµ‹ï¼‰
```

---

## ğŸ“‹ æ¸…ç†è¯¦æƒ…

### ç§»é™¤çš„ä»£ç 

#### æ–‡ä»¶: core/spider.go

**ç§»é™¤1**: å­—æ®µå®šä¹‰
```go
- urlPatternDOMDedup *URLPatternWithDOMDeduplicator
```

**ç§»é™¤2**: åˆå§‹åŒ–ä»£ç 
```go
- urlPatternDOMDedup: NewURLPatternWithDOMDeduplicator(
-     cfg.DeduplicationSettings.URLPatternDOMSampleCount,
-     cfg.DeduplicationSettings.URLPatternDOMThreshold,
- ),
```

**ç§»é™¤3**: ä½¿ç”¨ä»£ç 
```go
- if s.urlPatternDOMDedup != nil {
-     shouldCrawl, reason, needsDOM := s.urlPatternDOMDedup.ShouldCrawl(link)
-     ...
- }
```

**ç§»é™¤4**: DOMç­¾åè®°å½•
```go
- if s.urlPatternDOMDedup != nil {
-     s.urlPatternDOMDedup.RecordDOMSignature(result.URL, result.HTMLContent)
- }
```

**ä¿ç•™**: æ‰“å°æŠ¥å‘Šå‡½æ•°ï¼ˆç©ºå®ç°ï¼Œä¿æŒå‘åå…¼å®¹ï¼‰
```go
func (s *Spider) PrintURLPatternDOMDedupReport() {
    // åŠŸèƒ½å·²è¢« DOM Embedding å’Œ ç›¸ä¼¼URLå»é‡ æ›¿ä»£ï¼Œä¸å†éœ€è¦
}
```

---

#### æ–‡ä»¶: core/dedup_coordinator.go

**ç§»é™¤1**: å­—æ®µå®šä¹‰
```go
- patternDOMDedup *URLPatternWithDOMDeduplicator
```

**ç§»é™¤2**: æ„é€ å‡½æ•°å‚æ•°
```go
- func NewDeduplicationCoordinator(
-     ...
-     patternDOMDedup *URLPatternWithDOMDeduplicator,
-     ...
- )
+ func NewDeduplicationCoordinator(
+     ...
+     // patternDOMDedup å·²ç§»é™¤
+     ...
+ )
```

**ç§»é™¤3**: ä½¿ç”¨ä»£ç 
```go
- if dc.patternDOMDedup != nil {
-     allow, reason, needsDOM := dc.patternDOMDedup.ShouldCrawl(normalizedURL)
-     ...
- }
```

**æ–°å¢**: è¾…åŠ©å‡½æ•°ï¼ˆä¿®å¤ç¼–è¯‘é”™è¯¯ï¼‰
```go
+ func getPercentage(part, total int) float64 {
+     if total == 0 {
+         return 0.0
+     }
+     return float64(part) * 100.0 / float64(total)
+ }
```

---

#### æ–‡ä»¶: cmd/spider/main.go

**ç§»é™¤**: æŠ¥å‘Šè°ƒç”¨
```go
- spider.PrintURLPatternDOMDedupReport()
```

---

#### æ–‡ä»¶: config.json

**ç§»é™¤**: é…ç½®é¡¹
```json
- "_v4.5_æ–°åŠŸèƒ½": "âœ… URLæ¨¡å¼+DOMç›¸ä¼¼åº¦å»é‡ï¼ˆæ›´ç²¾å‡†çš„å»é‡ç­–ç•¥ï¼‰",
- "enable_url_pattern_dom_dedup": true,
- "_url_pattern_dom_è¯´æ˜": "å¯¹URLç›¸ä¼¼çš„è¯·æ±‚å…ˆé‡‡æ ·3æ¬¡éªŒè¯DOMç›¸ä¼¼åº¦ï¼Œé¿å…è¯¯åˆ¤",
- "url_pattern_dom_sample_count": 3,
- "_sample_count_è¯´æ˜": "é‡‡æ ·æ¬¡æ•°ï¼Œé»˜è®¤3æ¬¡éªŒè¯",
- "url_pattern_dom_threshold": 0.85,
- "_threshold_è¯´æ˜": "DOMç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œé»˜è®¤85%",
```

---

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘æµ‹è¯•
```bash
âœ… ç¼–è¯‘æˆåŠŸï¼æ— é”™è¯¯
âœ… æ‰€æœ‰Linteræ£€æŸ¥é€šè¿‡
```

### åŠŸèƒ½æµ‹è¯•
```bash
âœ… æ–°çš„å»é‡åŠŸèƒ½æ­£å¸¸å·¥ä½œ
âœ… æ—§çš„æŠ¥å‘Šè°ƒç”¨ä¸æŠ¥é”™ï¼ˆç©ºå®ç°ï¼‰
âœ… é…ç½®æ–‡ä»¶ç®€åŒ–
```

---

## ğŸŠ æ¸…ç†åçš„ä¼˜åŠ¿

### 1. ä»£ç æ›´ç®€æ´ âœ¨
- åˆ é™¤590è¡ŒåºŸå¼ƒä»£ç 
- å‡å°‘1ä¸ªå»é‡å™¨
- é…ç½®é¡¹å‡å°‘6ä¸ª

### 2. æ€§èƒ½æ›´å¥½ âš¡
- æ— éœ€é‡‡æ ·éªŒè¯ï¼ˆèŠ‚çœ3æ¬¡è¯·æ±‚ï¼‰
- Hashç›´æ¥åˆ¤æ–­ï¼ˆæ›´å¿«ï¼‰
- Embeddingå‘é‡åŒ–ï¼ˆæ›´å‡†ï¼‰

### 3. ç»´æŠ¤æ›´å®¹æ˜“ ğŸ“š
- åŠŸèƒ½èŒè´£æ›´æ¸…æ™°
- ä»£ç ç»“æ„æ›´ç®€å•
- é…ç½®æ›´ç›´è§‚

---

## ğŸ“– è¿ç§»æŒ‡å—

### å¦‚æœä½ ä¹‹å‰ä½¿ç”¨äº† URLæ¨¡å¼+DOMå»é‡

**æ—§é…ç½®**:
```json
{
  "enable_url_pattern_dom_dedup": true,
  "url_pattern_dom_sample_count": 3,
  "url_pattern_dom_threshold": 0.85
}
```

**æ–°é…ç½®**ï¼ˆè‡ªåŠ¨ç”Ÿæ•ˆï¼‰:
```json
{
  "enable_similar_url_dedup": true,      // â† æ›¿ä»£URLæ¨¡å¼éƒ¨åˆ†
  "enable_dom_embedding": true,          // â† æ›¿ä»£DOMæ£€æµ‹éƒ¨åˆ†
  "dom_embedding_threshold": 0.85        // ç›¸åŒé˜ˆå€¼
}
```

**æ•ˆæœæ›´å¥½**: æ–°æ–¹æ¡ˆé€Ÿåº¦æ›´å¿«ï¼Œå‡†ç¡®æ€§æ›´é«˜ï¼

---

## ğŸ æ€»ç»“

### æ¸…ç†æˆæœ
- âŒ åˆ é™¤1ä¸ªæ–‡ä»¶
- ğŸ”§ ä¿®æ”¹4ä¸ªæ–‡ä»¶
- âœ… ç¼–è¯‘é€šè¿‡
- âœ… åŠŸèƒ½å®Œæ•´

### æ–°æ¶æ„ä¼˜åŠ¿
- âœ… æ›´å¿«ï¼ˆæ— éœ€é‡‡æ ·ï¼‰
- âœ… æ›´å‡†ï¼ˆ256ç»´å‘é‡ï¼‰
- âœ… æ›´çµæ´»ï¼ˆç‹¬ç«‹å¼€å…³ï¼‰
- âœ… æ›´ç®€æ´ï¼ˆä»£ç å‡å°‘ï¼‰

### ç”¨æˆ·ä½“éªŒ
- âœ… æ— éœ€ä¿®æ”¹ä½¿ç”¨æ–¹å¼
- âœ… æ€§èƒ½è‡ªåŠ¨æå‡
- âœ… é…ç½®æ›´ç®€å•
- âœ… å‘åå…¼å®¹

---

**æ¸…ç†å®Œæˆï¼ä»£ç æ›´å¹²å‡€ï¼Œæ€§èƒ½æ›´å¼ºå¤§ï¼** ğŸ‰

**ç«‹å³æµ‹è¯•**: `.\spider.exe -config config.json`

---

**End of Document**

