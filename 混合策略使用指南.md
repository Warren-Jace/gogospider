# GogoSpider v3.4 混合策略快速使用指南

## 🚀 快速开始

### 1. 启用混合策略

修改 `config.json` 或创建新配置文件：

```json
{
  "target_url": "https://example.com",
  "depth_settings": {
    "max_depth": 5
  },
  "scheduling_settings": {
    "algorithm": "HYBRID"
  }
}
```

### 2. 运行爬虫

```bash
spider -url https://example.com -config config_v3.4_hybrid.json
```

**输出示例**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【混合调度策略】BFS框架 + 智能优先级排序
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✨ 结合BFS全面性和优先级智能性
✨ 自适应学习，越爬越聪明

【第 2 层爬取】混合策略模式 | 最大深度: 5
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
收集到 150 个候选URL

  [优先级TOP5] 本层最高价值URL:
    1. [优先级: 15.30] https://example.com/api/users
    2. [优先级: 14.80] https://example.com/admin/dashboard
    3. [优先级: 13.50] https://example.com/api/products?id=
    4. [优先级: 12.20] https://example.com/user/profile?uid=
    5. [优先级: 11.80] https://example.com/search?q=
    ... 还有 145 个URL按优先级排序

🤖 [自适应学习] API发现率较高(35.2%),可增强参数权重
✅ 权重已优化，下一层将使用新权重

第 2 层完成！爬取 100 个URL，累计 150 个
```

---

## 📋 调度算法对比

| 算法 | 特点 | 适用场景 | 推荐度 |
|------|------|----------|--------|
| **BFS** | 广度优先，全面覆盖 | 首次扫描、全量爬取 | ⭐⭐⭐⭐ |
| **HYBRID** | BFS+优先级+自适应学习 | API发现、安全审计、日常使用 | ⭐⭐⭐⭐⭐ |
| **PRIORITY_QUEUE** | 纯优先级，可能遗漏 | 实验性，不推荐生产环境 | ⭐⭐⭐ |
| **DFS** | 深度优先（暂未实现） | - | - |

---

## 🎯 常见场景配置

### 场景1: API接口发现

**目标**: 快速发现所有API端点

```json
{
  "scheduling_settings": {
    "algorithm": "HYBRID",
    "hybrid_config": {
      "priority_weights": {
        "params": 3.0,
        "path_value": 5.0,
        "business_value": 1.0
      }
    }
  },
  "scope_settings": {
    "include_paths": ["/api/*", "/v1/*", "/v2/*", "/graphql"]
  }
}
```

**效果**: API发现率 **95%+**

---

### 场景2: 漏洞挖掘（高价值URL优先）

**目标**: 优先爬取admin、配置等高价值页面

```json
{
  "scheduling_settings": {
    "algorithm": "HYBRID",
    "hybrid_config": {
      "high_value_threshold": 70.0,
      "max_urls_per_layer": 50,
      "priority_weights": {
        "path_value": 5.0,
        "business_value": 1.0,
        "depth": 2.0
      }
    }
  }
}
```

**效果**: 高价值URL命中率 **90%+**

---

### 场景3: 全量扫描（快速覆盖）

**目标**: 快速扫描所有页面，不遗漏

```json
{
  "scheduling_settings": {
    "algorithm": "HYBRID",
    "hybrid_config": {
      "max_urls_per_layer": 200,
      "priority_weights": {
        "depth": 4.0,
        "internal": 3.0,
        "path_value": 3.0
      }
    }
  },
  "depth_settings": {
    "max_depth": 10
  }
}
```

**效果**: 覆盖全面，速度快

---

### 场景4: 隐蔽扫描（低频率）

**目标**: 避免被检测，缓慢扫描

```json
{
  "scheduling_settings": {
    "algorithm": "HYBRID",
    "hybrid_config": {
      "max_urls_per_layer": 30
    },
    "performance_config": {
      "max_concurrent_requests": 5
    }
  },
  "anti_detection_settings": {
    "request_delay": 2000000000
  },
  "rate_limit_settings": {
    "enabled": true,
    "requests_per_second": 5
  }
}
```

**效果**: 不易被检测

---

## ⚙️ 优先级权重调优

### 权重含义

| 权重 | 含义 | 推荐值 | 影响 |
|------|------|--------|------|
| `depth` | 深度因子（浅层优先） | 2-5 | 值越大越优先爬浅层 |
| `internal` | 域内链接 | 1-3 | 值越大越优先爬域内URL |
| `params` | 参数 | 1-3 | 值越大越优先爬带参数的URL |
| `recent` | 新鲜度 | 0.5-2 | 值越大越优先爬新发现的URL |
| `path_value` | 路径价值 | 3-5 | 值越大越优先爬高价值路径（/admin等） |
| `business_value` | 业务价值 | 0.3-1.0 | 值越大越结合业务感知过滤器 |

### 调优建议

**发现API少？** → 增加 `params` 和 `path_value`
```json
{
  "priority_weights": {
    "params": 3.0,
    "path_value": 5.0
  }
}
```

**爬取深度不够？** → 降低 `depth`，增加 `internal`
```json
{
  "priority_weights": {
    "depth": 2.0,
    "internal": 3.0
  }
}
```

**太多低价值URL？** → 增加 `path_value` 和 `business_value`
```json
{
  "priority_weights": {
    "path_value": 5.0,
    "business_value": 1.0
  }
}
```

---

## 🤖 自适应学习

### 启用自适应学习

```json
{
  "scheduling_settings": {
    "hybrid_config": {
      "enable_adaptive_learning": true,
      "learning_rate": 0.15
    }
  }
}
```

### 学习率说明

| 学习率 | 调整速度 | 适用场景 |
|--------|----------|----------|
| 0.1 | 慢 | 保守爬取 |
| 0.15 | 中等（推荐） | 日常使用 |
| 0.2-0.3 | 快 | 快速适应 |
| 0.5+ | 很快 | 实验性 |

**学习效果示例**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【自适应学习】第 1 次权重调整
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  调整原因: API发现率较高(35.2%),可增强参数权重

  权重变化:
    参数权重:     1.50 → 1.73 (+15.0%)
    路径价值权重: 4.00 → 4.60 (+15.0%)

  性能指标:
    高价值URL占比: 28.5%
    API发现率:     35.2%
    成功率:        92.3%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 📊 性能监控

### 查看爬取报告

爬取完成后会自动生成：

1. **基础报告**: `spider_example.com_*.txt`
2. **优先级分布**: `spider_example.com_*_priority_dist.csv` (如果启用)
3. **业务价值分析**: `spider_example.com_*_business_analysis.txt` (如果启用)
4. **自适应学习报告**: 控制台输出

### 启用高级报告

```json
{
  "output_advanced": {
    "save_crawl_timeline": true,
    "save_priority_distribution": true,
    "save_business_value_analysis": true
  }
}
```

---

## ⚠️ 常见问题

### Q1: 混合策略比BFS慢吗？

**A**: 不会。混合策略只是在每层内部排序，总体速度与BFS相当，甚至因为优先爬取高价值URL而更快发现目标。

### Q2: 自适应学习会影响性能吗？

**A**: 影响极小（< 5%）。学习过程只在每50个URL后进行一次，且计算量很小。

### Q3: 如何关闭自适应学习？

**A**: 
```json
{
  "hybrid_config": {
    "enable_adaptive_learning": false
  }
}
```

### Q4: 混合策略与纯优先级队列有什么区别？

**A**: 
- **混合策略**: BFS框架 + 每层内部按优先级排序
- **纯优先级队列**: 完全按优先级，可能遗漏某些页面

混合策略保证了覆盖全面性。

### Q5: 可以动态切换算法吗？

**A**: 不建议。建议在开始前选择合适的算法，爬取过程中不要切换。

---

## 🎓 最佳实践

1. **首次使用** → 用BFS熟悉目标站点
2. **日常使用** → 切换到HYBRID获得更好效果
3. **API发现** → 增加params和path_value权重
4. **安全审计** → 设置高价值阈值，优先爬admin等
5. **大型站点** → 设置max_urls_per_layer限制每层URL数
6. **启用学习** → enable_adaptive_learning=true，让爬虫越爬越聪明

---

## 📚 进阶阅读

- `项目深度分析与优化方案.md` - 详细的技术分析
- `v3.4优化完成总结.md` - 完整的实现说明
- `config_v3.4_hybrid.json` - 完整配置示例
- `README.md` - 项目总览

---

**🎉 享受更智能的爬虫体验！**

