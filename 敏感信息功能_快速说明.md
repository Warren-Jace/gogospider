# 🔒 敏感信息检测功能 - 快速说明

## ✅ **您的三个问题的答案**

### **问题1：敏感信息是否保存到单独文件中，并指明来源地址和信息类型？**

**答案：✅ 是的！完全满足要求**

**保存位置：**
```
spider_{domain}_{timestamp}_sensitive.txt    # 单独的敏感信息文件
```

**文件内容示例：**
```
【高危发现】
[1] API密钥泄露                        ← 信息类型
    来源URL: https://example.com/config.js  ← 来源地址
    位置: Line 45                      ← 精确位置
    值: sk_test_****xyz                ← 脱敏值

[2] 数据库密码
    来源URL: https://example.com/db.php
    位置: Line 23
    值: pass****123
```

---

### **问题2：敏感信息检测是否针对每个返回数据包？**

**答案：✅ 是的！每个数据包都会检测**

**检测时机：**
```
发送请求 → 接收响应 → addResult() → 🔍 敏感信息检测
                                    ├─ 扫描响应体
                                    └─ 扫描响应头
```

**代码位置：** `core/spider.go` 第733-775行

```go
// 每次添加爬取结果时都会执行
if s.config.SensitiveDetectionSettings.Enabled {
    // 检测响应体
    bodyFindings := s.sensitiveDetector.Scan(result.HTMLContent, result.URL)
    
    // 检测响应头
    headerFindings := s.sensitiveDetector.Scan(headerContent, result.URL)
}
```

---

### **问题3：敏感信息检测是否是统一功能？**

**答案：✅ 是的！完全统一**

**统一架构：**
```
Spider
├─ sensitiveDetector   (统一检测器)
├─ sensitiveManager    (统一管理器)
├─ sensitiveFindings   (统一存储)
└─ config.SensitiveDetectionSettings (统一配置)
```

**统一配置文件：**
```json
{
  "sensitive_detection_settings": {
    "enabled": true,                     // 统一开关
    "scan_response_body": true,          // 扫描响应体
    "scan_response_headers": true,       // 扫描响应头
    "rules_file": "sensitive_rules_standard.json"  // 统一规则
  }
}
```

---

## 📊 **完整信息记录**

每条敏感信息包含以下字段：

```go
type SensitiveInfo struct {
    Type       string  // ✅ 敏感信息类型（API密钥、密码、邮箱等）
    SourceURL  string  // ✅ 来源URL地址（完整记录）
    Location   string  // ✅ 具体位置（Line 45）
    Value      string  // ✅ 脱敏后的值
    FullValue  string  // ✅ 完整值（内部使用）
    Severity   string  // ✅ 严重程度（HIGH/MEDIUM/LOW）
    LineNumber int     // ✅ 行号
}
```

---

## 🚀 **如何查看敏感信息检测结果**

### **方法1：运行测试脚本（推荐）**

```bash
# Windows
测试敏感信息检测.bat

# 会自动：
# 1. 运行爬虫
# 2. 生成敏感信息报告
# 3. 显示文件预览
```

### **方法2：手动运行**

```bash
# 1. 运行爬虫（敏感信息检测默认开启）
./spider -url https://testphp.vulnweb.com -sensitive-rules sensitive_rules_standard.json

# 2. 查看生成的文件
dir spider_*_sensitive.*

# 3. 查看文本报告
type spider_testphp.vulnweb.com_*_sensitive.txt

# 4. 查看HTML可视化报告（最推荐）
start sensitive_*.html
```

---

## 📁 **生成的文件清单**

运行后会生成以下独立文件：

| 文件名 | 说明 | 包含内容 |
|--------|------|---------|
| `spider_{domain}_{time}_sensitive.txt` | 详细文本报告 | ✅ 来源URL + 类型 + 位置 |
| `sensitive_{domain}_{time}.json` | JSON数据 | ✅ 结构化数据 |
| `sensitive_{domain}_{time}.csv` | Excel表格 | ✅ 可用Excel分析 |
| `sensitive_{domain}_{time}.html` | 可视化报告 | ✅ 浏览器直接查看 |
| `sensitive_{domain}_{time}_summary.txt` | 快速摘要 | ✅ 总览统计 |

---

## 🎯 **核心特性**

### ✅ **全面检测**
- 每个HTTP响应都检测
- 响应体和响应头都扫描
- 支持自定义规则

### ✅ **完整记录**
- 敏感信息类型
- 来源URL地址
- 精确行号位置
- 严重程度分级

### ✅ **独立保存**
- 单独的敏感信息文件
- 与爬取结果分离
- 多种格式可选

### ✅ **统一管理**
- 统一的检测器
- 统一的配置
- 统一的导出

---

## 💡 **实际使用示例**

### **示例1：基本使用**

```bash
# 运行爬虫（会自动检测敏感信息）
./spider -url https://example.com

# 查看结果
type spider_example.com_*_sensitive.txt
```

### **示例2：自定义规则**

```bash
# 使用自定义规则文件
./spider -url https://example.com -sensitive-rules my_rules.json
```

### **示例3：批量扫描**

```bash
# 批量扫描多个目标
./spider -batch-file targets.txt

# 每个目标都会生成独立的敏感信息报告
```

---

## 📊 **实际输出示例**

### **文本报告（spider_*_sensitive.txt）**

```
==========================================
   敏感信息泄露检测报告
==========================================

扫描页面数: 150
发现总数: 12
  - 高危: 2
  - 中危: 6
  - 低危: 4

==========================================

【高危发现】
------------------------------------------------------------

[1] API密钥泄露
    来源URL: https://example.com/js/config.js
    位置: Line 15
    值: AIza****************************xyz

[2] 数据库连接密码
    来源URL: https://example.com/config/database.php
    位置: Line 8
    值: db_p****word

【中危发现】
------------------------------------------------------------

[3] 内部IP地址
    来源URL: https://example.com/admin/dashboard
    位置: Line 45
    值: 192.168.1.100

[4] 邮箱地址
    来源URL: https://example.com/contact.html
    位置: Line 89
    值: admin@example.com
```

### **JSON报告（sensitive_*.json）**

```json
{
  "scan_time": "2025-10-28 15:36:37",
  "target_domain": "example.com",
  "statistics": {
    "total_findings": 12,
    "high_severity": 2,
    "medium_severity": 6,
    "low_severity": 4
  },
  "findings": [
    {
      "type": "API密钥泄露",
      "value": "AIza****************************xyz",
      "source_url": "https://example.com/js/config.js",
      "location": "Line 15",
      "severity": "HIGH"
    }
  ]
}
```

---

## ✅ **总结**

您提出的所有要求**都已完全实现**：

1. ✅ **独立保存**：敏感信息保存在单独文件中
2. ✅ **完整记录**：每条记录都包含来源URL和信息类型
3. ✅ **全面检测**：针对每个返回数据包进行检测
4. ✅ **统一功能**：通过统一的检测器和配置管理

**建议：**
- 运行 `测试敏感信息检测.bat` 立即查看效果
- 查看生成的HTML报告（最直观）
- 根据需要自定义规则文件

---

**GogoSpider v4.2** - 专业的敏感信息检测系统！

生成时间：2025-10-28

