# Spider Pro - 新增功能说明文档

本文档详细介绍Spider Pro在本次优化中新增的5个重要功能。

---

## 🎯 功能一：批量URL输入

### 功能描述
支持从文件中读取多个URL，批量进行爬取，适用于需要扫描多个目标的场景。

### 使用方法

#### 1. 创建URL列表文件
创建一个文本文件（例如 `urls.txt`），每行一个URL：

```txt
http://example1.com
http://example2.com
https://test.example.com
# 这是注释，会被忽略
http://api.example.com
```

#### 2. 运行批量爬取
```bash
# 使用批量URL文件
spider-pro -urls urls.txt -depth 2

# 也可以指定其他参数
spider-pro -urls urls.txt -depth 3 -algorithm BFS
```

### 特性
- ✅ 自动跳过空行和注释行（以 # 开头）
- ✅ URL格式验证（必须以 http:// 或 https:// 开头）
- ✅ 每个URL生成独立的报告文件
- ✅ 失败不中断，继续处理下一个URL
- ✅ 显示进度信息（例如：[1/5] 处理中...）

### 报告文件命名
```
spider_example1.com_20251021_150405.txt
spider_example2.com_20251021_150420.txt
spider_test.example.com_20251021_150435.txt
```

### 应用场景
- 资产管理：批量扫描公司所有子系统
- 安全测试：批量检测多个目标网站
- 信息收集：批量分析竞品网站

---

## 🎯 功能二：表单关键字模糊匹配

### 功能描述
在智能表单填充时，使用模糊匹配算法识别字段类型，支持驼峰命名、下划线、拼写相近等多种情况。

### 匹配策略

#### 1. 完全包含匹配
```
字段名: user_email  → 匹配: email ✓
字段名: phoneNumber → 匹配: phone ✓
```

#### 2. 分词匹配（支持驼峰和下划线）
```
字段名: userEmail   → 拆分为: [user, email] → 匹配: email ✓
字段名: user_phone  → 拆分为: [user, phone] → 匹配: phone ✓
字段名: contactName → 拆分为: [contact, name] → 匹配: name ✓
```

#### 3. 反向包含匹配
```
字段名: mail        → 关键字: email → 匹配 ✓
字段名: pwd         → 关键字: password → 匹配 ✓
```

#### 4. 编辑距离相似度匹配（80%阈值）
```
字段名: emial       → 关键字: email → 相似度: 80% → 匹配 ✓
字段名: passward    → 关键字: password → 相似度: 87.5% → 匹配 ✓
```

### 技术实现
使用 **Levenshtein距离算法** 计算字符串相似度：
- 支持插入、删除、替换操作
- 动态规划实现，时间复杂度 O(m*n)
- 80%相似度阈值，平衡准确性和召回率

### 使用示例

#### 示例1：驼峰命名
```go
字段名: userEmail
匹配关键字: email
结果: 自动填充 "test@example.com"
```

#### 示例2：下划线命名
```go
字段名: user_phone_number
匹配关键字: phone
结果: 自动填充 "13800138000"
```

#### 示例3：拼写错误
```go
字段名: emial_address  // 拼写错误
匹配关键字: email
结果: 通过相似度匹配，自动填充 "test@example.com"
```

### 优势
- 🚀 更智能的字段识别
- 🎯 支持多种命名风格（驼峰、下划线、中划线）
- 💪 容错性强，可识别拼写错误
- 🌍 支持多语言字段名

---

## 🎯 功能三：Wappalyzer规则扩展

### 功能描述
大幅扩展技术栈检测规则，从原来的15种增加到50+种，覆盖更多框架、库和工具。

### 新增检测技术

#### CSS框架
- Bootstrap (支持版本检测)
- Tailwind CSS

#### 前端框架
- Next.js (React SSR框架)
- Nuxt.js (Vue SSR框架)
- Svelte

#### CMS系统
- Joomla (支持版本检测)
- Drupal (支持版本检测)
- Magento (电商平台)
- Shopify (电商平台)

#### 后端框架
- Express.js (Node.js)
- Flask (Python)
- Ruby on Rails
- Gin (Go)
- Koa (Node.js)
- ThinkPHP (PHP)
- Yii (PHP)
- CodeIgniter (PHP)

#### JavaScript库
- Axios (HTTP客户端)
- Lodash (工具库)
- Moment.js (日期处理)
- Chart.js (图表库)

#### CDN服务
- jsDelivr
- unpkg
- cdnjs
- Google Hosted Libraries

#### 分析和监控
- Google Analytics
- 百度统计
- 腾讯分析

#### 部署平台
- Vercel
- Netlify
- Docker
- Kubernetes

### 检测方法

#### 1. HTTP响应头检测
```
X-Powered-By: Express
Server: nginx/1.18.0
X-Drupal-Cache: HIT
```

#### 2. HTML内容检测
```html
<!-- Bootstrap -->
<link href="bootstrap.min.css">
<div class="container">

<!-- React -->
<div id="root" data-reactroot>

<!-- Vue.js -->
<div v-if="show">
```

#### 3. JavaScript特征检测
```javascript
// jQuery
$(document).ready(function(){});

// React
React.createElement();

// Vue
new Vue({ el: '#app' });
```

#### 4. Cookie检测
```
laravel_session (Laravel)
PHPSESSID (PHP)
ASP.NET_SessionId (ASP.NET)
```

#### 5. Meta标签检测
```html
<meta name="generator" content="WordPress 5.8">
<meta name="generator" content="Drupal 9.0">
```

### 报告示例
```
═══════════════════════════════════════════════
【技术栈识别】
═══════════════════════════════════════════════

[前端框架]
  ✓ React 18.2.0 (置信度:90%)
     证据: HTML: <div data-reactroot>
     证据: JavaScript: React.createElement
  ✓ Bootstrap 5.1.3 (置信度:85%)
     证据: HTML: bootstrap.min.css

[CSS框架]
  ✓ Tailwind CSS (置信度:75%)
     证据: HTML: flex grid hidden

[Web服务器]
  ✓ Nginx 1.18.0 (置信度:100%)
     证据: Header: Server=nginx/1.18.0

[CDN]
  ✓ Cloudflare (置信度:95%)
     证据: Header: CF-RAY=123abc
```

### 价值
- 📊 更全面的技术栈识别
- 🎯 精准的版本检测
- 🔒 安全漏洞评估依据
- 📈 技术选型参考

---

## 🎯 功能四：子域名提取

### 功能描述
自动从HTML、JavaScript、CSS等内容中提取子域名，用于信息收集和资产发现。

### 提取来源

#### 1. HTML内容
```html
<!-- 标准URL -->
<a href="http://api.example.com">
<img src="https://cdn.example.com/logo.png">

<!-- href和src属性 -->
<script src="//static.example.com/app.js">
```

#### 2. JavaScript代码
```javascript
// API配置
var apiUrl = "https://api.example.com";
var apiEndpoint = "api.subdomain.example.com";

// 域名变量
domain: "admin.example.com"
host: "www.example.com"

// location重定向
location.href = "http://login.example.com";
window.location = "https://portal.example.com";
```

#### 3. CSS文件
```css
/* url()引用 */
@font-face {
  src: url('https://fonts.example.com/font.woff');
}

background: url('http://images.example.com/bg.jpg');
```

#### 4. 注释中的域名
```javascript
// 开发环境: http://dev.example.com
// 生产环境: http://prod.example.com
```

### 提取模式

#### 支持的格式
```
✅ http://subdomain.example.com
✅ https://subdomain.example.com  
✅ //subdomain.example.com
✅ subdomain.example.com
✅ "domain": "api.example.com"
✅ api_url: "admin.example.com"
```

#### 自动过滤
```
❌ 非目标域名的URL
❌ 无效的域名格式
❌ 只包含主域名（无子域名）
```

### 报告示例
```
═══════════════════════════════════════════════
【扫描统计】
═══════════════════════════════════════════════
  • 发现的子域名: 12

[子域名发现]
  发现子域名总数: 12
  子域名列表:
    1. admin.example.com
    2. api.example.com
    3. cdn.example.com
    4. dev.example.com
    5. images.example.com
    6. login.example.com
    7. mail.example.com
    8. mobile.example.com
    9. portal.example.com
    10. static.example.com
    11. test.example.com
    12. www.example.com
```

### 子域名层级分析
```
一级子域名 (3个):
  - www.example.com
  - api.example.com
  - cdn.example.com

二级子域名 (2个):
  - admin.portal.example.com
  - v2.api.example.com
```

### 应用场景
- 🔍 资产发现：找到所有相关子域名
- 🎯 攻击面分析：识别潜在入口点
- 📊 架构分析：了解系统结构
- 🔐 安全评估：发现遗忘的测试环境

---

## 🎯 功能五：代理服务器模式

### 功能描述
启动HTTP代理服务器，拦截浏览器或工具的请求，实时分析和记录所有HTTP流量。

### 使用方法

#### 1. 启动代理服务器
```bash
# 启动代理（默认监听 127.0.0.1:8080）
spider-pro -proxy

# 指定监听地址和端口
spider-pro -proxy -proxy-addr 127.0.0.1:9090

# 只记录特定域名的请求
spider-pro -proxy -url http://example.com
```

#### 2. 配置浏览器代理

**Chrome/Edge:**
1. 设置 → 系统 → 打开代理设置
2. HTTP代理：127.0.0.1:8080
3. HTTPS代理：127.0.0.1:8080

**Firefox:**
1. 设置 → 网络设置 → 手动代理配置
2. HTTP代理：127.0.0.1 端口：8080
3. 勾选"也将此代理用于HTTPS"

**cURL:**
```bash
curl -x http://127.0.0.1:8080 http://example.com
```

**Python Requests:**
```python
proxies = {
    'http': 'http://127.0.0.1:8080',
    'https': 'http://127.0.0.1:8080',
}
requests.get('http://example.com', proxies=proxies)
```

### 功能特性

#### 1. 请求拦截
```
[拦截] GET http://example.com/api/users - 200 (1234 bytes)
[拦截] POST http://example.com/login - 302 (89 bytes)
[拦截] GET http://example.com/profile - 200 (5678 bytes)
```

#### 2. 实时统计
```
[统计] 请求: 45, 响应: 45, 流量: 2.34 MB
[统计] 请求: 78, 响应: 78, 流量: 5.67 MB
```

#### 3. HTTPS支持
通过CONNECT隧道支持HTTPS流量（不解密内容）：
```
[HTTPS隧道] api.example.com:443
[HTTPS隧道] cdn.example.com:443
```

#### 4. 智能过滤
自动过滤静态资源，只记录重要请求：
```
✅ 记录: /api/users
✅ 记录: /login
✅ 记录: /profile
❌ 跳过: /static/app.css
❌ 跳过: /images/logo.png
❌ 跳过: /fonts/roboto.woff
```

### 生成报告

按 `Ctrl+C` 停止服务器后，自动生成详细报告：

```
╔═══════════════════════════════════════════════╗
║              代理拦截报告                      ║
╚═══════════════════════════════════════════════╝

=== 代理服务器统计 ===
总请求数: 156
总响应数: 156
总流量: 12.45 MB
运行时间: 305.23 秒

按主机统计:
  example.com: 89 请求
  api.example.com: 45 请求
  cdn.example.com: 22 请求

按方法统计:
  GET: 134 请求
  POST: 18 请求
  PUT: 3 请求
  DELETE: 1 请求

拦截的请求总数: 156
拦截的响应总数: 156

详细报告已保存到: proxy_report_20251021_150405.txt
```

### 详细报告内容
```
=== 拦截的请求 ===

[1] POST http://example.com/api/login
    时间: 15:04:05
    请求体: {"username":"admin","password":"test123"}

[2] GET http://example.com/api/users?page=1
    时间: 15:04:12

[3] PUT http://example.com/api/users/123
    时间: 15:04:25
    请求体: {"name":"John","email":"john@example.com"}

=== 拦截的响应 ===

[1] http://example.com/api/login - 200
    时间: 15:04:05
    大小: 456 bytes
    类型: application/json

[2] http://example.com/api/users?page=1 - 200
    时间: 15:04:12
    大小: 3456 bytes
    类型: application/json
```

### 应用场景

#### 1. API分析
- 抓取所有API端点
- 分析请求/响应格式
- 记录认证token

#### 2. 自动化测试
- 录制测试场景
- 重放HTTP请求
- 性能分析

#### 3. 安全测试
- 拦截敏感数据
- 修改请求参数
- 测试注入点

#### 4. 逆向工程
- 分析APP通信协议
- 发现隐藏接口
- 理解业务逻辑

### 技术特点
- 🚀 高性能：异步处理，支持并发
- 🔒 安全：支持HTTPS隧道
- 📊 统计：实时流量监控
- 🎯 过滤：智能跳过静态资源
- 💾 记录：完整保存请求/响应

---

## 📊 功能对比总结

| 功能 | 来源 | 实现难度 | 价值评级 | 使用场景 |
|------|------|----------|----------|----------|
| 批量URL输入 | gospider | ⭐⭐ | ⭐⭐⭐ | 批量扫描、资产管理 |
| 表单模糊匹配 | crawlergo | ⭐⭐⭐ | ⭐⭐⭐⭐ | 智能表单填充 |
| Wappalyzer规则 | katana | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 技术栈识别 |
| 子域名提取 | gospider | ⭐⭐⭐ | ⭐⭐⭐ | 信息收集 |
| 代理服务器 | katana | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 实时分析、API测试 |

---

## 🎉 总结

本次优化共新增 **5个重要功能**，极大地增强了Spider Pro的能力：

### 核心优势
1. **更智能** - 模糊匹配、自动识别
2. **更全面** - 50+技术栈、子域名发现
3. **更高效** - 批量处理、实时监控
4. **更专业** - 代理模式、深度分析

### 使用建议
- 🎯 **日常扫描** → 使用批量URL功能
- 🔍 **信息收集** → 启用子域名提取
- 🛡️ **安全测试** → 配合代理模式使用
- 📊 **技术分析** → 查看Wappalyzer检测结果

### 下一步计划
- [ ] HAR文件导出（代理模式）
- [ ] 子域名暴力枚举
- [ ] 实时WebSocket支持
- [ ] 分布式爬取

---

**Spider Pro v2.2 - 更智能、更强大、更专业的Web爬虫！** 🚀

