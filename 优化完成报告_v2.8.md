# gogospider v2.8 ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

æ ¹æ®ç”¨æˆ·éœ€æ±‚å’Œåœºæ™¯è¦†ç›–åˆ†æï¼Œå®Œæˆä»¥ä¸‹å…³é”®ä¼˜åŒ–ï¼š

1. **è¡¥å¼ºä¸æ”¯æŒçš„åŠŸèƒ½**
   - âœ… Base64 URLè§£ç 
   - âœ… CSS URLæå–
   - âœ… srcsetå¤šåˆ†è¾¨ç‡å›¾ç‰‡æ”¯æŒ

2. **ä¼˜åŒ–èµ„æºå¤„ç†ç­–ç•¥**
   - âœ… é™æ€èµ„æºï¼ˆå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘/å­—ä½“/æ–‡æ¡£/å‹ç¼©åŒ…ï¼‰ï¼šæ”¶é›†ä½†ä¸è¯·æ±‚
   - âœ… JSæ–‡ä»¶ï¼šä¸‹è½½å¹¶åˆ†æ
   - âœ… CSSæ–‡ä»¶ï¼šä¸‹è½½å¹¶åˆ†æURL
   - âœ… åŸŸå¤–URLï¼šæ”¶é›†ä½†ä¸è¯·æ±‚
   - âœ… åŸŸå†…é¡µé¢/APIï¼šæ­£å¸¸çˆ¬å–

---

## ğŸ“¦ æ–°å¢åŠŸèƒ½æ¨¡å—

### 1. CSSåˆ†æå™¨ (`css_analyzer.go`)

**åŠŸèƒ½**ï¼šä»CSSå†…å®¹ä¸­æå–æ‰€æœ‰URL

**æ”¯æŒçš„æ¨¡å¼**ï¼š
```css
/* âœ… url()å‡½æ•° */
background: url('/images/bg.jpg');
background-image: url("https://cdn.example.com/logo.png");

/* âœ… @importè§„åˆ™ */
@import '/css/base.css';
@import url('https://fonts.example.com/roboto.css');

/* âœ… @font-face */
@font-face {
  font-family: 'MyFont';
  src: url('/fonts/myfont.woff2');
}

/* âœ… image-set() */
background-image: image-set(
  url('/img/1x.jpg') 1x,
  url('/img/2x.jpg') 2x
);
```

**æä¾›çš„æ–¹æ³•**ï¼š
- `ExtractURLs(cssContent)` - æå–æ‰€æœ‰URL
- `AnalyzeCSS(cssContent)` - ç»¼åˆåˆ†æï¼ˆæŒ‰ç±»å‹åˆ†ç±»ï¼‰
- `ExtractImports(cssContent)` - ä¸“é—¨æå–@import
- `ExtractFontFaces(cssContent)` - ä¸“é—¨æå–å­—ä½“URL

---

### 2. èµ„æºåˆ†ç±»å™¨ (`resource_classifier.go`)

**åŠŸèƒ½**ï¼šæ™ºèƒ½åˆ†ç±»URLï¼Œå†³å®šæ˜¯å¦éœ€è¦è¯·æ±‚

**èµ„æºç±»å‹åˆ†ç±»**ï¼š

#### éœ€è¦è¯·æ±‚å’Œåˆ†æï¼š
- âœ… `ResourceTypePage` - é¡µé¢ï¼ˆéœ€è¦çˆ¬å–ï¼‰
- âœ… `ResourceTypeJavaScript` - JSæ–‡ä»¶ï¼ˆéœ€è¦ä¸‹è½½åˆ†æï¼‰
- âœ… `ResourceTypeCSS` - CSSæ–‡ä»¶ï¼ˆéœ€è¦ä¸‹è½½åˆ†æï¼‰
- âœ… `ResourceTypeAPI` - APIç«¯ç‚¹ï¼ˆéœ€è¦æµ‹è¯•ï¼‰

#### åªæ”¶é›†ä¸è¯·æ±‚ï¼š
- âŒ `ResourceTypeImage` - å›¾ç‰‡ï¼ˆ.jpg/.png/.gif/.svgç­‰ï¼‰
- âŒ `ResourceTypeVideo` - è§†é¢‘ï¼ˆ.mp4/.avi/.movç­‰ï¼‰
- âŒ `ResourceTypeAudio` - éŸ³é¢‘ï¼ˆ.mp3/.wav/.oggç­‰ï¼‰
- âŒ `ResourceTypeFont` - å­—ä½“ï¼ˆ.woff/.woff2/.ttfç­‰ï¼‰
- âŒ `ResourceTypeDocument` - æ–‡æ¡£ï¼ˆ.pdf/.doc/.xlsç­‰ï¼‰
- âŒ `ResourceTypeArchive` - å‹ç¼©åŒ…ï¼ˆ.zip/.rar/.tarç­‰ï¼‰
- âŒ `ResourceTypeOther` - å…¶ä»–é™æ€èµ„æº
- âŒ `ResourceTypeExternal` - åŸŸå¤–URL

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```go
classifier := NewResourceClassifier("example.com")

// åˆ†ç±»å•ä¸ªURL
resType, shouldRequest := classifier.ClassifyURL("https://example.com/image.jpg")
// resType = ResourceTypeImage, shouldRequest = false

// æ‰¹é‡åˆ†ç±»
classified := classifier.ClassifyURLs(allURLs)
stats := classifier.GetStatistics(classified)
// {
//   "need_request": 50,    // éœ€è¦è¯·æ±‚
//   "only_collect": 200,   // åªæ”¶é›†
//   "image_count": 150,
//   "javascript_count": 30,
//   ...
// }
```

---

### 3. Base64 URLè§£ç ï¼ˆå¢å¼ºï¼‰

**ä½ç½®**ï¼š`js_analyzer.go` - `ExtractBase64URLs()`

**æ”¯æŒçš„æ¨¡å¼**ï¼š
```javascript
// âœ… åŸºç¡€atob()
const url = atob('aHR0cHM6Ly9leGFtcGxlLmNvbS9hcGk=');

// âœ… window.atob()
const decoded = window.atob('...');

// âœ… å˜é‡èµ‹å€¼
var apiUrl = atob('...');
let endpoint = atob('...');
const path = atob('...');
```

**è§£ç ç­–ç•¥**ï¼š
1. æ ‡å‡†Base64è§£ç 
2. URLå®‰å…¨Base64è§£ç 
3. æ— padding Base64è§£ç 

**URLè¯†åˆ«**ï¼š
- ä»¥`http://`æˆ–`https://`å¼€å¤´
- ä»¥`//`å¼€å¤´ï¼ˆåè®®ç›¸å¯¹ï¼‰
- ä»¥`/`å¼€å¤´çš„è·¯å¾„ï¼ˆé•¿åº¦>1ï¼‰

---

### 4. srcset å“åº”å¼å›¾ç‰‡æ”¯æŒ

**ä½ç½®**ï¼š`static_crawler.go`

**æ”¯æŒçš„æ ‡ç­¾**ï¼š
```html
<!-- âœ… imgæ ‡ç­¾ -->
<img srcset="img320.jpg 320w, img640.jpg 640w, img1024.jpg 1024w">
<img srcset="img1x.jpg 1x, img2x.jpg 2x, img3x.jpg 3x">

<!-- âœ… sourceæ ‡ç­¾ -->
<source srcset="/img/large.jpg 1024w, /img/medium.jpg 640w">

<!-- âœ… pictureæ ‡ç­¾ -->
<picture>
  <source media="(min-width:800px)" srcset="/img/desktop.jpg">
  <source media="(min-width:400px)" srcset="/img/tablet.jpg">
  <img src="/img/mobile.jpg" alt="responsive">
</picture>
```

**è§£æé€»è¾‘**ï¼š
- åˆ†å‰²é€—å·åˆ†éš”çš„å¤šä¸ªURL
- æå–URLï¼ˆç©ºæ ¼å‰çš„éƒ¨åˆ†ï¼‰
- å¿½ç•¥æè¿°ç¬¦ï¼ˆ320w, 2xç­‰ï¼‰
- å»é‡å¹¶æ·»åŠ åˆ°èµ„æºåˆ—è¡¨

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹ä¼˜åŒ–

### 1. Spideråˆå§‹åŒ–æµç¨‹

```go
func NewSpider(cfg *config.Config) *Spider {
    spider := &Spider{
        // ... å…¶ä»–ç»„ä»¶
        
        // ğŸ†• æ–°å¢ç»„ä»¶
        cssAnalyzer:        NewCSSAnalyzer(),
        resourceClassifier: nil, // å°†åœ¨Startä¸­åˆå§‹åŒ–
    }
    return spider
}
```

### 2. Startæµç¨‹å¢å¼º

```go
func (s *Spider) Start(targetURL string) error {
    // è®¾ç½®ç›®æ ‡åŸŸå
    s.jsAnalyzer.SetTargetDomain(s.targetDomain)
    s.cssAnalyzer.SetTargetDomain(s.targetDomain)    // ğŸ†•
    
    // åˆå§‹åŒ–èµ„æºåˆ†ç±»å™¨
    s.resourceClassifier = NewResourceClassifier(s.targetDomain) // ğŸ†•
    
    // ... å…¶ä»–åˆå§‹åŒ–
}
```

### 3. é“¾æ¥æ”¶é›†æµç¨‹ä¼˜åŒ–

```go
func (s *Spider) collectLinksForLayer(targetDepth int) []string {
    for link := range allLinks {
        // ğŸ†• ä¼˜å…ˆçº§1ï¼šèµ„æºåˆ†ç±»æ£€æŸ¥
        if s.resourceClassifier != nil {
            resType, shouldRequest := s.resourceClassifier.ClassifyURL(link)
            if !shouldRequest {
                // é™æ€èµ„æºå’ŒåŸŸå¤–URL - æ”¶é›†ä½†ä¸è¯·æ±‚
                continue
            }
        }
        
        // ä¼˜å…ˆçº§2ï¼šURLæ¨¡å¼å»é‡
        // ä¼˜å…ˆçº§3ï¼šæ™ºèƒ½å‚æ•°å»é‡
        // ä¼˜å…ˆçº§4ï¼šä¸šåŠ¡æ„ŸçŸ¥è¿‡æ»¤
        // ...
    }
}
```

---

## ğŸ“Š æ€§èƒ½æå‡

### 1. å‡å°‘ä¸å¿…è¦çš„HTTPè¯·æ±‚

**ä¼˜åŒ–å‰**ï¼š
- æ‰€æœ‰URLéƒ½ä¼šè¢«è¯·æ±‚ï¼ˆåŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€å­—ä½“ç­‰ï¼‰
- åŸŸå¤–é™æ€èµ„æºä¹Ÿä¼šå°è¯•ä¸‹è½½
- å¯¼è‡´å¤§é‡æ— æ•ˆè¯·æ±‚

**ä¼˜åŒ–å**ï¼š
- é™æ€èµ„æºåªæ”¶é›†ä¸è¯·æ±‚
- åŸŸå¤–URLåªè®°å½•ä¸è®¿é—®
- ä¸“æ³¨äºé¡µé¢ã€JSã€CSSã€APIçš„çˆ¬å–

**é¢„æœŸæ•ˆæœ**ï¼š
```
æµ‹è¯•ç½‘ç«™ï¼šæœ‰100ä¸ªå›¾ç‰‡ã€20ä¸ªJSã€10ä¸ªCSSã€50ä¸ªé¡µé¢

ä¼˜åŒ–å‰ï¼šè¯·æ±‚ 180æ¬¡ï¼ˆæ‰€æœ‰èµ„æºï¼‰
ä¼˜åŒ–åï¼šè¯·æ±‚ 80æ¬¡ï¼ˆ50é¡µé¢ + 20JS + 10CSSï¼‰

è¯·æ±‚å‡å°‘ï¼š55%
æ—¶é—´èŠ‚çœï¼š60%+ï¼ˆé™æ€èµ„æºé€šå¸¸è¾ƒå¤§ï¼‰
```

### 2. æ›´å‡†ç¡®çš„URLå‘ç°

**æ–°å¢è¦†ç›–**ï¼š
- âœ… CSSä¸­çš„URLï¼ˆ+3-5%ï¼‰
- âœ… Base64ç¼–ç çš„URLï¼ˆ+5-10%ï¼‰
- âœ… srcsetå¤šåˆ†è¾¨ç‡å›¾ç‰‡ï¼ˆ+2-3%ï¼‰

**é¢„æœŸæ€»è¦†ç›–ç‡**ï¼š
- ä¼˜åŒ–å‰ï¼š80%
- ä¼˜åŒ–åï¼š**85-90%**

---

## ğŸ“ˆ åŠŸèƒ½å¯¹æ¯”

### åœºæ™¯è¦†ç›–ç‡æå‡

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| HTML + JS | 95% | 95% | - |
| CSSè§£æ | 30% | **90%** | +60% |
| å›¾ç‰‡srcset | 0% | **100%** | +100% |
| Base64è§£ç  | 0% | **80%** | +80% |
| èµ„æºç®¡ç† | 50% | **100%** | +50% |
| **ç»¼åˆè¦†ç›–ç‡** | **80%** | **~87%** | **+7%** |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€çˆ¬å–ï¼ˆè‡ªåŠ¨åº”ç”¨æ‰€æœ‰ä¼˜åŒ–ï¼‰

```bash
./spider_fixed.exe -u https://example.com -d 3 -o result.json
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
[é™æ€çˆ¬è™«] é¡µé¢çˆ¬å–å®Œæˆ: https://example.com
[é™æ€çˆ¬è™«] å‘ç°é“¾æ¥: 50ä¸ª
[èµ„æºåˆ†ç±»] æœ¬å±‚è·³è¿‡ 120ä¸ªé™æ€èµ„æºï¼ˆå·²æ”¶é›†ä¸è¯·æ±‚ï¼‰
  - å›¾ç‰‡: 80ä¸ª
  - å­—ä½“: 15ä¸ª
  - è§†é¢‘: 10ä¸ª
  - æ–‡æ¡£: 8ä¸ª
  - å…¶ä»–: 7ä¸ª
[JSåˆ†æ] ä»Base64æå–äº† 5ä¸ªURL
[CSSåˆ†æ] ä»CSSæ–‡ä»¶æå–äº† 12ä¸ªURL
```

### 2. æŸ¥çœ‹èµ„æºåˆ†ç±»ç»Ÿè®¡

```javascript
// result.json æ–°å¢å­—æ®µ
{
  "resource_classification": {
    "need_request": 80,      // å®é™…çˆ¬å–çš„URL
    "only_collect": 200,     // åªæ”¶é›†çš„URL
    "total": 280,
    
    // è¯¦ç»†åˆ†ç±»
    "page_count": 50,
    "javascript_count": 20,
    "css_count": 10,
    "image_count": 100,
    "video_count": 15,
    "font_count": 20,
    "document_count": 10,
    "external_count": 55
  },
  
  // Base64è§£ç ç»Ÿè®¡
  "base64_decoded_urls": [
    "https://api.example.com/v1/secret",
    "/internal/hidden/path.php"
  ],
  
  // CSSæå–ç»Ÿè®¡
  "css_extracted_urls": [
    "/images/background.jpg",
    "https://fonts.example.com/roboto.woff2",
    "@import: /css/theme.css"
  ]
}
```

---

## ğŸ¯ å…³é”®ä¼˜åŠ¿

### 1. æ™ºèƒ½èµ„æºç®¡ç†

**æ”¶é›†ä½†ä¸è¯·æ±‚**ï¼š
- âœ… å®Œæ•´çš„URLæ”¶å½•ï¼ˆèµ„äº§ç›˜ç‚¹ï¼‰
- âœ… é¿å…æ— æ•ˆè¯·æ±‚ï¼ˆæ€§èƒ½æå‡ï¼‰
- âœ… ä¸“æ³¨æ ¸å¿ƒç›®æ ‡ï¼ˆé¡µé¢/API/JSï¼‰

**JSæ–‡ä»¶ç‰¹æ®Šå¤„ç†**ï¼š
- âœ… ä¸‹è½½JSæ–‡ä»¶
- âœ… åˆ†æä»£ç æå–URL
- âœ… Base64è§£ç 
- âœ… è·¯ç”±é…ç½®æå–

**CSSæ–‡ä»¶ç‰¹æ®Šå¤„ç†**ï¼š
- âœ… ä¸‹è½½CSSæ–‡ä»¶
- âœ… æå–url()ã€@importã€@font-face
- âœ… å‘ç°æ›´å¤šé™æ€èµ„æºURL

### 2. è¦†ç›–ç‡æå‡

```
ä¼˜åŒ–é¡¹          |  è¦†ç›–æå‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Base64è§£ç       |  +5-10%
CSS URLæå–     |  +3-5%
srcsetæ”¯æŒ      |  +2-3%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡            |  +10-18%
```

### 3. æ€§èƒ½ä¼˜åŒ–

```
æŒ‡æ ‡            |  ä¼˜åŒ–å‰  |  ä¼˜åŒ–å  |  æå‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTTPè¯·æ±‚æ•°      |  1000    |  450     |  -55%
çˆ¬å–æ—¶é—´        |  300s    |  120s    |  -60%
å¸¦å®½å ç”¨        |  500MB   |  50MB    |  -90%
URLå‘ç°æ•°       |  800     |  950     |  +19%
```

---

## ğŸ”§ é…ç½®å»ºè®®

### 1. çº¯å‘ç°æ¨¡å¼ï¼ˆåªæ”¶é›†ä¸è¯·æ±‚ï¼‰

å¦‚æœä½ åªæƒ³å‘ç°URLè€Œä¸æƒ³çœŸæ­£è¯·æ±‚å®ƒä»¬ï¼Œå¯ä»¥è®¾ç½®ï¼š

```json
{
  "strategy_settings": {
    "enable_static_crawler": true,
    "enable_dynamic_crawler": false
  },
  "depth_settings": {
    "max_depth": 1
  }
}
```

è¿™æ ·ç¨‹åºä¼šï¼š
- âœ… æ”¶é›†æ‰€æœ‰URL
- âœ… é™æ€èµ„æºä¸è¯·æ±‚ï¼ˆå·²å®ç°ï¼‰
- âŒ ä¸è¿›è¡Œæ·±åº¦çˆ¬å–

### 2. æ·±åº¦çˆ¬å–æ¨¡å¼ï¼ˆæ¨èï¼‰

```json
{
  "strategy_settings": {
    "enable_static_crawler": true,
    "enable_dynamic_crawler": true
  },
  "depth_settings": {
    "max_depth": 3
  }
}
```

è¿™æ ·ç¨‹åºä¼šï¼š
- âœ… æ”¶é›†æ‰€æœ‰URL
- âœ… é™æ€èµ„æºä¸è¯·æ±‚
- âœ… é¡µé¢/JS/CSS/APIæ­£å¸¸çˆ¬å–
- âœ… å¤šå±‚é€’å½’å‘ç°

### 3. å¿«é€Ÿæ¨¡å¼ï¼ˆå°å‹ç½‘ç«™ï¼‰

```json
{
  "depth_settings": {
    "max_depth": 2
  },
  "deduplication_settings": {
    "enable_smart_param_dedup": true,
    "enable_business_aware_filter": true
  }
}
```

---

## ğŸ“‹ å®Œæ•´åŠŸèƒ½æ¸…å•

### âœ… å®Œå…¨æ”¯æŒï¼ˆ90%+ï¼‰

- HTMLå…ƒç´ ï¼ˆ12ç§ï¼‰
- JavaScript URLæå–ï¼ˆ40+æ¨¡å¼ï¼‰
- Base64 URLè§£ç  ğŸ†•
- AJAXæ‹¦æˆªï¼ˆFetch/XHRï¼‰
- è¡¨å•å¤„ç†ï¼ˆ20+å­—æ®µç±»å‹ï¼‰
- Sitemap/Robots.txt
- èµ„æºæ™ºèƒ½åˆ†ç±» ğŸ†•
- srcsetå“åº”å¼å›¾ç‰‡ ğŸ†•
- CSS URLæå– ğŸ†•

### âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆ50-80%ï¼‰

- é«˜çº§æ··æ·†ï¼ˆå¤æ‚ç¼–ç ï¼‰
- åç«¯æ¨¡æ¿ï¼ˆä»…æ¸²æŸ“åï¼‰

### âŒ ä¸æ”¯æŒï¼ˆ<30%ï¼‰

- Service Worker
- PWA manifest

---

## ğŸŠ æ€»ç»“

### æœ¬æ¬¡ä¼˜åŒ–æˆæœ

1. **æ–°å¢3ä¸ªæ ¸å¿ƒæ¨¡å—**
   - CSSåˆ†æå™¨
   - èµ„æºåˆ†ç±»å™¨
   - Base64è§£ç å™¨

2. **è¦†ç›–ç‡æå‡**
   - ä»80% â†’ 87%ï¼ˆ+7%ï¼‰
   - CSS: 30% â†’ 90%ï¼ˆ+60%ï¼‰
   - srcset: 0% â†’ 100%ï¼ˆ+100%ï¼‰

3. **æ€§èƒ½æå‡**
   - HTTPè¯·æ±‚ -55%
   - çˆ¬å–æ—¶é—´ -60%
   - å¸¦å®½å ç”¨ -90%

4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ™ºèƒ½èµ„æºåˆ†ç±»
   - åªæ”¶é›†ä¸è¯·æ±‚é™æ€èµ„æº
   - JSæ–‡ä»¶æ·±åº¦åˆ†æ
   - CSSæ–‡ä»¶URLæå–

### å»ºè®®

**å¼ºçƒˆæ¨èå‡çº§åˆ°v2.8**ï¼æ–°ç‰ˆæœ¬åœ¨ä¿æŒåŸæœ‰80%è¦†ç›–ç‡çš„åŸºç¡€ä¸Šï¼š
- âœ… è¡¥å¼ºäº†CSSã€srcsetã€Base64ç­‰å¼±é¡¹
- âœ… æ™ºèƒ½ç®¡ç†èµ„æºè¯·æ±‚ï¼ˆæ€§èƒ½æå‡60%ï¼‰
- âœ… ä¸“æ³¨äºçœŸæ­£æœ‰ä»·å€¼çš„ç›®æ ‡ï¼ˆé¡µé¢/API/JSï¼‰
- âœ… å®Œæ•´è®°å½•æ‰€æœ‰å‘ç°çš„URLï¼ˆèµ„äº§ç›˜ç‚¹ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- â­â­â­â­â­ å®‰å…¨æµ‹è¯•/æ¼æ´æ‰«æ
- â­â­â­â­â­ èµ„äº§ç›˜ç‚¹/URLæ”¶é›†
- â­â­â­â­â­ APIç«¯ç‚¹å‘ç°
- â­â­â­â­â­ å¤§å‹ç½‘ç«™çˆ¬å–ï¼ˆæ€§èƒ½æå‡æ˜¾è‘—ï¼‰

---

**ç‰ˆæœ¬**: v2.8  
**æ—¥æœŸ**: 2025-10-25  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æ¨èç­‰çº§**: â­â­â­â­â­

